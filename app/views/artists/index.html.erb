<h1>Artist Search</h1>
<i>(search for artists you would like to follow)</i>
<br>
<br>
<%= form_tag(artists_path, method: :get) do %>
  <div class="form-group">
    <%= label_tag(:query, "Search artist by name:") %>
    <%= text_field_tag(:query, params[:query], class: 'form-control', autofocus: true, placeholder: "Enter artist name") %>
  </div>
  <div class="form-group">
    <%= submit_tag("Search", class: 'btn btn-success') %>
  </div>
<% end %>

<% unless @hash_version.nil? %>
  <% @hash_version["artists"]["items"].each_with_index do |band, index| %>
    <% if index == @hash_version["artists"]["items"].size - 1 %>
      <li class="artist_li">
        <%= image_tag(band["images"].first["url"], class: 'img-responsive artist_img') rescue image_tag("microphone.png", class: 'img-responsive artist_img mic_bg') %>
        <br>
        <h1 class="artist_name"><%= band["name"] %></h1>
        <br>
        <% if band["genres"].empty? %>
          <h5>no genres</h5>
        <% else %>
          <h5><%= band["genres"] %></h5>
        <% end %>
        <br>
        <h5><%= band["followers"]["total"] %> followers</h5>
        <br>

        <!-- ATTEMPT AT ALLOWING A USER TO FOLLOW/UNFOLLOW AN ARTIST -->
        
        <% if follow = current_user.follows.find_by(artist_id: "#{band['id']}") %>
          <%= link_to "Unfollow", artist_follow_path("#{band['id']}", follow), method: :delete, id: current_user.id %>
        <% else %>
          <%= link_to "Follow", artist_follows_path("#{band['id']}", user_id: current_user.id), method: :post, id: current_user.id %>
        <% end %>
        
        <!-- no hr with last li -->
      </li>
    <% else %>
      <li class="artist_li">
        <%= image_tag(band["images"].first["url"], class: 'img-responsive artist_img') rescue image_tag("microphone.png", class: 'img-responsive artist_img mic_bg') %>
        <br>
        <h1 class="artist_name"><%= band["name"] %></h1>
        <br>
        <% if band["genres"].empty? %>
          <h5>no genres</h5>
        <% else %>
          <h5><%= band["genres"] %></h5>
        <% end %>
        <br>
        <h5><%= band["followers"]["total"] %> followers</h5>
        <br>

<!-- ATTEMPT AT ALLOWING A USER TO FOLLOW/UNFOLLOW AN ARTIST -->
        
        <% if follow = current_user.follows.find_by(artist_id: "#{band['id']}") %>
          <%= link_to "Unfollow", artist_follow_path("#{band['id']}", follow), method: :delete, id: current_user.id %>
        <% else %>
          <%= link_to "Follow", artist_follows_path("#{band['id']}", user_id: current_user.id), method: :post, id: current_user.id %>
        <% end %>

        <hr class="artists_hr">
      </li>
    <% end %>
  <% end %>
<% end %>